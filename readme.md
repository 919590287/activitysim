# 出行需求建模系统

## 项目简介

本项目是一个**端到端的出行需求建模系统**，实现了从研究区域定义到个体出行链生成的完整流程。系统集成了 PopulationSim 和 ActivitySim 两大开源交通建模工具，提供了友好的 Streamlit Web 界面，支持一键运行全流程。

### 核心功能

- **研究区域处理**：支持 Shapefile/ZIP 上传，自动坐标系转换
- **OSM 数据下载**：使用 OSMnx 自动获取建筑、POI 数据
- **土地利用构建**：将建筑面积转换为就业岗位和人口容量
- **路网与 Skim 矩阵**：支持 MATSim 路网或简化欧氏距离方法
- **合成人口生成**：PopulationSim（支持有种子/无种子模式）
- **活动链生成**：ActivitySim 生成出行链 (tours) 和出行段 (trips)
- **结果可视化**：交互式地图、图表、统计分析
- **结果导出**：CSV、GeoJSON、OMX 格式

---

## 系统架构
┌─────────────────────────────────────────────────────────────────┐
│ Streamlit Web 界面 │
│ (文件上传、参数配置、进度显示、结果可视化、文件下载) │
└─────────────────────────┬───────────────────────────────────────┘
│
▼
┌─────────────────────────────────────────────────────────────────┐
│ Pipeline 流程编排 │
│ (协调各模块按顺序执行，管理数据传递) │
└─────────────────────────┬───────────────────────────────────────┘
│
┌─────────────────┼─────────────────┐
│ │ │
▼ ▼ ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│ Shapefile │ │ OSM POI │ │ MATSim │
│ 处理模块 │ │ 下载模块 │ │ 路网解析 │
└──────┬───────┘ └──────┬───────┘ └──────┬───────┘
│ │ │
└────────┬────────┴─────────────────┘
│
▼
┌─────────────────────────────────────────────────────────────────┐
│ Land Use 构建模块 │
│ (建筑面积 → 就业/人口，按 TAZ 聚合) │
└─────────────────────────┬───────────────────────────────────────┘
│
┌─────────────────┴─────────────────┐
│ │
▼ ▼
┌──────────────────┐ ┌──────────────────┐
│ PopulationSim │ │ Skim 矩阵构建 │
│ (合成人口生成) │ │ (OD 时间/距离) │
└────────┬─────────┘ └────────┬─────────┘
│ │
└────────────┬────────────────────┘
│
▼
┌─────────────────────────┐
│ ActivitySim │
│ (活动链与出行段生成) │
└────────┬────────────────┘
│
▼
┌─────────────────────────┐
│ 输出结果 │
│ - tours.csv │
│ - trips.csv │
│ - 统计报告 │
└─────────────────────────┘